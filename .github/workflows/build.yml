name: Build NEW APP Version

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. –ü–æ–ª—É—á–∏—Ç—å –°–í–ï–ñ–ò–ô –∫–æ–¥
    - name: üì• Get LATEST code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # –ü–æ–ª—É—á–∞–µ–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
        
    # 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Flutter
    - name: ‚öôÔ∏è Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.16.9'
        
    # 3. –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    - name: üì± Show app version
      run: |
        echo "=== –¢–ï–ö–£–©–ê–Ø –í–ï–†–°–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==="
        grep "version:" pubspec.yaml
        echo "================================"
        
    # 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - name: üì¶ Install packages
      run: |
        echo "=== –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–Æ –ó–ê–í–ò–°–ò–ú–û–°–¢–ò ==="
        flutter pub get
        echo "‚úÖ –ì–æ—Ç–æ–≤–æ"
        
    # 5. –û–ß–ò–°–¢–ò–¢–¨ –≤—Å—ë
    - name: üßπ Clean EVERYTHING
      run: |
        echo "=== –ü–û–õ–ù–ê–Ø –û–ß–ò–°–¢–ö–ê ==="
        flutter clean
        rm -rf build/
        rm -rf .dart_tool/
        echo "‚úÖ –í—Å—ë –æ—á–∏—â–µ–Ω–æ"
        
    # 6. –°–æ–±—Ä–∞—Ç—å –ù–û–í–´–ô APK
    - name: üî® Build NEW APK
      run: |
        echo "=== –°–û–ë–ò–†–ê–Æ –ù–û–í–£–Æ –í–ï–†–°–ò–Æ 1.0.8 ==="
        echo "–í—Ä–µ–º—è: $(date '+%Y-%m-%d %H:%M:%S')"
        flutter build apk --release --no-tree-shake-icons
        echo "‚úÖ –ù–û–í–´–ô APK –°–û–ë–†–ê–ù!"
        
    # 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ù–û–í–û–ï
    - name: üîç Check NEW file
      run: |
        echo "=== –ü–†–û–í–ï–†–ö–ê –§–ê–ô–õ–ê ==="
        ls -la build/app/outputs/flutter-apk/
        echo "üíæ –†–∞–∑–º–µ—Ä –Ω–æ–≤–æ–≥–æ APK:"
        du -h build/app/outputs/flutter-apk/app-release.apk
        echo "üïê –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:"
        stat build/app/outputs/flutter-apk/app-release.apk
        
    # 8. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å –ù–û–í–´–ú –∏–º–µ–Ω–µ–º
    - name: ‚¨ÜÔ∏è Upload NEW APK
      uses: actions/upload-artifact@v4
      with:
        name: NEW-VERSION-1.0.8-$(date +%s)
        path: build/app/outputs/flutter-apk/app-release.apk
        retention-days: 1
